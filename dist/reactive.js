"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const _=new Map,c={createStore(t){_.has(t)||(_.set(t,new Map),Object.defineProperty(c,t,{get(){return _.get(t)}}))}};c.createStore("tickets");function x(t){const e=t.queue.at(t.ticket);return t.ticket+=1,t.queue.length===t.ticket&&(t.ticket=0),e}function E(t){c.tickets.has(t.type)||c.tickets.set(t.type,{reInvoke:!1,ticket:0,queue:[]});const e=c.tickets.get(t.type);return t.isReInvoke&&(e.reInvoke=!0),e}function b(t){const e=E(t);return e.reInvoke?x(e):e}class k{constructor(e,n,r){this.type=e,this.target=n,this.data=r,this.timeStamp=Date.now()}}class R extends k{constructor(){super(...arguments),this.$queue=[]}addListener(e){return this.$queue.push(e),this}_invoke(){for(const e of this.$queue)e(new k(this.type,this.target,this.data))}}class F extends Set{_invokeAll(e){for(const n of Array.from(this))n._invoke()}_findIn(e,n){return Array.from(this).find(r=>r[e]===n)}}function f(t){return Array.isArray(t)?t:[t]}function A(t){return typeof t.type=="string"?f(t.node):t.childs.map(S).flat()}function S(t){return t.node?t.node:V(t).flat()}function V(t){const e=[];for(const n of t.childs){let r=n;n instanceof g&&(r=S(n)),e.push(r)}return e}function H(t){let e=t;for(;e&&typeof e.node!="object";)e=e.parentNode;return e}function N(t=!1){const e={};t&&(e.children=this.originalChilds);for(const n in this.properties)t&&n==="shareContext"?e.sharedContext=this.properties[n]:e[n==="className"?"class":n]=this.properties[n];return e}function Y(t,e){let n,r;function o(){n&&(clearTimeout(n),n=null)}return function(){n||(r=[this,arguments],n=setTimeout(function(){o();const[s,i]=r;t.apply(s,i)},e))}}function z(t){const e=new Map;return(n,r)=>{if(r&&r.superCtx&&!e.has(n))e.set(n,new F([new R("changeState",n,r).addListener(t)]));else if(r)e.has(n)&&r.superCtx&&e.get(n).add(new R("changeState",n,r).addListener(t));else return e.get(n)}}const y=z(t=>{t.target.$update(t.data)}),G=(()=>{let t;const e=Y(()=>{const n=t;t=null,n&&n._invoke()},10);return(n,r)=>{t=n._findIn("data",r),e()}})();function J(t,e,n){return typeof t[e]=="function"?t[e].bind(t):t[e]}function m(t,e=!1){const n=p.component,r=b(n);if(r instanceof h)return r;const o=new Proxy(new h(t,e),{get(s,i){if(i in s)return i==="set"&&n?u=>(s.set(u),G(y(n),o)):J(s,i);if(typeof s.value[i]!="undefined")return!Array.isArray(s.value)&&s.value instanceof Object?s.value[i]:typeof s.value[i]=="function"?(...u)=>{if(typeof s.value[i].apply(s.value,u)!="undefined")return new d(s.value[i].apply(s.value,u),o)}:o;throw new Error("error proxy "+i)},set(s,i,u){if(i in s)s[i]=u;else if(i in s.data)s.data[i]=u;else return!1;return!0}});return typeof r=="object"&&r.queue.push(o),y(n,o),o}function K(t){const e={},n=s=>i=>{e[s].set(i)},r=s=>{let i;return()=>(i||(i=m(t[s])),i)};for(let s in t){const i=typeof t[s]=="function"?{value:t[s].bind(e)}:{get:r(s),set:n(s)};Object.defineProperty(e,s,i)}let o;return()=>o!=null?o:o=m(e)}var L=(t=>(t[t.CREATE=0]="CREATE",t[t.NEW=1]="NEW",t[t.UPDATE=2]="UPDATE",t[t.DELETE=3]="DELETE",t))(L||{});class d{constructor(e,n){this.state=n,this._parentNode=null,this.node=null,this.node=e.map(r=>r.render())}set parentNode(e){this._parentNode=e,y(this.state,e)}get parentNode(){return this._parentNode}}class q{constructor(e,n,r=0){this.superCtx=n,this.TYPE_ACTION=r,this.store=[],this.data=e}set data(e){var n;Array.isArray(e)&&(this.TYPE_ACTION=e.length>((n=this.previousData)==null?void 0:n.length)?2:3),this.store.push(e)}get data(){return this.store.at(-1)}get previousData(){return this.store.at(-2)}toString(){var e,n;return(n=(e=this.data)==null?void 0:e.toString())!=null?n:""}}class h{constructor(e,n){this._store=new Map,this.currentStoreState=new q(e,n)}get parentNode(){return this.currentParentNode}get superCtx(){return this.currentStoreState.superCtx}get previousData(){return this.currentStoreState.previousData}set parentNode(e){}get value(){return this.currentStoreState.data}set value(e){this.currentStoreState.data=e}addProxySelf(e){return this.proxySelf=e,this}set(e){this.value=e}is(e){return this.value===e}toString(){return this.currentStoreState.toString()}[Symbol.toPrimitive](){return this.toString()}*[Symbol.iterator](){for(const e of this.value)yield e}}var Q=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)},v=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},X=(t,e,n)=>(Q(t,e,"access private method"),n),D,O,C,M,j,$;function Z(t){this.isReInvoke=!0,p.component=this;const e=this.parentNode,n=typeof this.type=="function"?H(this):this,r=this.childs,o={findIndex:[],oldChilds:[]},s=t.superCtx?o:this.childs.reduce((u,a,l)=>((a instanceof h&&a.currentStoreState===t||a instanceof d&&a.state.currentStoreState===t)&&(u.findIndex.push(l),u.oldChilds.push(a instanceof h?a.toString():a.node)),u),o),i=typeof this.type=="function"?this.type.call(this,N.call(this,!0)):!1;i!==!1&&(i.parentNode=this,this.childs=f(i)),i instanceof g&&(i.isReInvoke=!0,i.render());for(let u=0;u<s.findIndex.length;u++){const a=s.findIndex[u],l=s.oldChilds[u];this.widgedHelper.updateWidget(new class{getNodeParent(){return n.node}getParent(){return e}get index(){return a}get newChilds(){return i instanceof d?i.node:i instanceof g?f(i):l}get oldChilds(){return l}})}s.findIndex.length===0&&this.widgedHelper.updateWidget(new class{getNodeParent(){return n.node}getParent(){return e}get index(){return-1}get newChilds(){return i instanceof d?i.node:i instanceof g?f(i):i}get oldChilds(){return r}})}const p={pos:0,current:0,component:null},W=class P{constructor(e,n,r,o){this.type=e,this.properties=n,this.widgedHelper=r,this.originalChilds=o,v(this,D),v(this,O),v(this,C),v(this,j),v(this,$),this.isReInvoke=!1,this.node=void 0,this.parentNode=void 0,this.childs=void 0,this._id=p.pos,this._ns=!1,this._fnparent=void 0,this._listenerOnCreate=()=>{},typeof this.type=="string"&&this.type==="svg"&&(this._ns=!0),n&&n.onCreate&&(this._listenerOnCreate=n.onCreate,delete this.properties.onCreate);for(let s of o)this._ns&&s instanceof P&&(s._ns=!0),typeof this.type=="function"&&s instanceof P&&(s._fnparent=this);p.pos++}createNodeAndChilds(){typeof this.type=="string"&&(this.node=this.widgedHelper.createWidget(this.type,this._ns),this.childs=f(this.originalChilds))}render(){if(p.component=this,this.node&&(this.widgedHelper.setProperties(this.node,N.call(this)),this.isReInvoke&&this.widgedHelper.resetWidgets&&this.widgedHelper.resetWidgets(A(this))),typeof this.type=="function"&&!this.childs){const e=N.call(this,!0),n=this.type.name==="Fragment"?this.type(e):this.type.call(this,e);this.childs=f(n)}return X(this,C,M).call(this),this._listenerOnCreate(this.node),this}getNodeWidget(){return typeof this.node=="object"?this:H(this)}$update(e){Z.call(this,e.currentStoreState)}};D=new WeakSet;O=new WeakSet;C=new WeakSet;M=function(){this.getNodeWidget();for(let t of this.childs)(t instanceof W||t instanceof h||t instanceof d)&&(t.parentNode=this),t instanceof W?(typeof this.type=="function"?t._fnparent=this.type.name!=="Fragment"?this:this._fnparent:typeof this.type=="string"&&this._fnparent&&(t._fnparent=this._fnparent),typeof t.type=="string"&&this._ns&&(t._ns=!0,t.createNodeAndChilds()),this.isReInvoke&&(t.createNodeAndChilds(),t.isReInvoke=!0),t.render(),this.widgedHelper.appendWidget(this,t)):t instanceof d?this.widgedHelper.appendWidget(this,t):this.widgedHelper.appendWidget(this,t instanceof h?(y(t,this),t.toString()):t)};j=new WeakSet;$=new WeakSet;let g=W;function U(t){const e=E(p.component);return e.reInvoke?x(e):(e.queue.push(t),t)}c.createStore("memo");function B(t){const e=U(t);return c.memo.has(e)||c.memo.set(e,!1),(...n)=>(c.memo.get(e)===!1&&c.memo.set(e,e(...n)),c.memo.get(e))}let w;const I=t=>t.find(e=>ee(e.properties));function ee({path:t}){const e=location.hash.length&&location.hash.startsWith("#")?location.hash.slice(1):"/",r=new globalThis.URLPattern(t,location.origin).exec(e,location.origin);return w=r?{path:r.input,params:r.groups}:null,w!==null}function te({children:t,notFount:e}){var n;const r=m(!1),o=m(r.value?null:(n=I(t))!=null?n:e,!0);return B(()=>{window.addEventListener("hashchange",()=>{var s;r.value===!1&&r.set(!0),o.set((s=I(t))!=null?s:e)})})(),o.value.parentNode||(o.value.parentNode=this),o.value}function ne(t){return t.render.parentNode=this,t.render}function re(){return w.params}function ie(){return w.path}let T;function se(t){T=t}class oe{static Fragment({children:e}){return e}static createElement(e,n,...r){const o=Object.seal(new g(e,n||{},T,r));return o.createNodeAndChilds(),o}}function ae(t,e){return e.node=T.querySelector(t),e.render(),e}const ue=typeof window!="undefined";class ce{constructor(){this.resetWidgets=e=>{for(const n of e)n.innerHTML=""}}createWidget(e,n){return n?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e)}appendWidget(e,n){if(ue){if(typeof n.type=="function")return;const r=e.getNodeWidget(),o=n instanceof g?A(n):n instanceof d?n.node.map(S):n;Array.isArray(o)?r.node.append(...o):r.node.append(o)}}setProperties(e,n){for(const r in n){const o=n[r];r.startsWith("on")?e.addEventListener(r.slice(2).toLowerCase(),o):e.setAttribute(r==="className"?"class":r,String(o))}}querySelector(e){return document.querySelector(e)}updateWidget(e){var n;const r=e.getNodeParent();let{index:o,oldChilds:s,newChilds:i}=e;if(typeof i=="string")r.childNodes.item(o).data=i;else{i=i.map(a=>S(a)).flat(),s=s.map(a=>S(a)).flat();const u=i.length>s.length;for(let a=0;a<i.length;a++){const l=i[a];s[a]?s[a].replaceWith(l):r.insertBefore(l,(n=i[a-1])==null?void 0:n.nextSibling)}!u&&i.length!==s.length&&s.slice(i.length).forEach(a=>{a.remove()})}}}exports.HookStore=c;exports.NativeRender=ce;exports.Reactive=oe;exports.Route=ne;exports.Routes=te;exports.State=h;exports.StateAction=L;exports.StateRender=d;exports.StoreState=q;exports.addWidgetHelper=se;exports.createState=K;exports.createTicket=E;exports.exec=B;exports.flattenState=b;exports.listener=y;exports.nextTicket=x;exports.render=ae;exports.useCallback=U;exports.useParams=re;exports.usePath=ie;exports.useState=m;
